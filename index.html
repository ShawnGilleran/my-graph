<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Identity VR - Pro Build</title>
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <script src="https://unpkg.com/aframe-forcegraph-component/dist/aframe-forcegraph-component.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/c-frame/aframe-extras@7.2.0/dist/aframe-extras.min.js"></script>
    <style>
        body { margin: 0; background: #000; }
        #data-header { 
            position: fixed; top: 0; left: 0; width: 100%; 
            background: rgba(0, 30, 0, 0.9); color: #00ff88; 
            padding: 15px; font-family: monospace; font-size: 18px;
            border-bottom: 2px solid #00ff88; z-index: 9999; text-align: center;
        }
    </style>
</head>
<body>
    <div id="data-header">READY FOR CLOUD...</div>

    <a-scene background="color: #010101" renderer="antialias: false; precision: mediump;" webxr="referenceSpaceType: local;">
        
        <a-entity id="rig" movement-controls="fly: true; speed: 1.2;" position="0 0 100">
            <a-entity camera look-controls position="0 1.6 0">
                <a-entity cursor="rayOrigin: mouse;" raycaster="objects: [forcegraph-node];"></a-entity>
            </a-entity>
            
            <a-entity oculus-touch-controls="hand: left"></a-entity>
            <a-entity oculus-touch-controls="hand: right" laser-controls="hand: right" raycaster="objects: [forcegraph-node]; far: 500;">
                <a-text id="vr-label" value="Point at a node..." position="0 0.1 0" rotation="-90 0 0" width="1" color="#00ff88" align="center"></a-text>
            </a-entity>
        </a-entity>

        <a-entity light="type: ambient; intensity: 1.5"></a-entity>

        <a-entity id="graph" 
            forcegraph="
                node-id: id; 
                link-source: source; 
                link-target: target; 
                node-rel-size: 5;
                link-directional-particles: 3;
                warmup-ticks: 150; 
                cooldown-ticks: 0;
            ">
        </a-entity>
    </a-scene>

    <script>
        const header = document.getElementById('data-header');
        const vrLabel = document.getElementById('vr-label');
        const graphEl = document.getElementById('graph');

        fetch(`./vr_graph_data.json?t=${Date.now()}`)
            .then(res => res.json())
            .then(data => {
                header.innerHTML = "DATABASE LOADED. GENERATING...";

                // Start immediately for Browser, or wait for VR
                const initGraph = () => {
                    graphEl.setAttribute('forcegraph', {
                        nodes: data.nodes,
                        links: data.links,
                        onNodeHover: (node) => {
                            if (node) {
                                const txt = `IDENTIFIED: ${node.name}`;
                                header.innerHTML = txt; // For Mac
                                vrLabel.setAttribute('value', node.name); // For VR Wrist
                            }
                        }
                    });
                    header.innerHTML = "CLOUD DEPLOYED. FLY TO DATA.";
                };

                // Run for Mac
                initGraph();

                // Vertical Flight Logic for VR Thumbstick
                document.querySelector('a-scene').addEventListener('enter-vr', () => {
                    header.innerHTML = "VR MODE ACTIVE";
                });
            });
    </script>
</body>
</html>
